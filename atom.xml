<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title></title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2018-11-11T07:02:52.246Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title></title>
    <link href="http://yoursite.com/2018/11/30/Centos7%E7%9A%84%E5%90%AF%E5%8A%A8%E5%8F%8A%E7%AE%A1%E7%90%86/"/>
    <id>http://yoursite.com/2018/11/30/Centos7的启动及管理/</id>
    <published>2018-11-30T12:24:23.767Z</published>
    <updated>2018-11-11T07:02:52.246Z</updated>
    
    <content type="html"><![CDATA[<p>systemd<br>POST –&gt; Boot Sequence –&gt; Bootloader –&gt; kernel + initramfs(initrd) –&gt; rootfs –&gt; /sbin/init<br>init: CentOS 5 SysV init<br>CentOS 6 Upstart<br>CentOS 7 Systemd<br>Systemd：系统启动和服务器守护进程管理器，负责在系统启动 或运行时，激活系统资源，服务器进程和其它进程<br>Systemd新特性<br>系统引导时实现服务并行启动<br>按需启动守护进程<br>自动化的服务依赖关系管理<br>同时采用socket式与D-Bus总线式激活服务<br>系统状态快照    </p><ul><li>总结：<br>grub的区别<br>系统的第一个进程的区别  </li></ul><ul><li>systemd<br>核心概念：unit<br>unit表示不同类型的systemd对象，通过配置文件进行标识和配置；文件中主要包含了系统服务、监听socket、保存的系统快照以及其它与init相关的信息<br>配置文件<br>/usr/lib/systemd/system:每个服务最主要的启动脚本设置，类似于之前的/etc/init.d/<br>/run/systemd/system：系统执行过程中所产生的服务脚本，比上面目录优先运行<br>/etc/systemd/system：管理员建立的执行脚本，类似于  /etc/rcN.d/Sxx的功能，比上面目录优先运行  </li></ul><p>Unit类型<br>systemctl –t help 查看unit类型<br>service unit: 文件扩展名为.service, 用于定义系统服务<br>Target unit: 文件扩展名为.target，用于模拟实现运行级别<br>Device unit: .device, 用于定义内核识别的设备<br>Mount unit: .mount, 定义文件系统挂载点<br>Socket unit: .socket, 用于标识进程间通信用的socket文  件，也可在系统启动时，延迟启动服务，实现按需启动<br>Snapshot unit: .snapshot, 管理系统快照<br>Swap unit: .swap, 用于标识swap设备<br>Automount unit: .automount，文件系统的自动挂载点<br>Path unit: .path，用于定义文件系统中的一个文件或目录使 用,常用于当文件系统变化时，延迟激活服务，如：spool 目录 </p><ul><li>特性<br>关键特性：<br>基于socket的激活机制：socket与服务程序分离<br>基于d-bus的激活机制：<br>基于device的激活机制：<br>基于path的激活机制：<br>系统快照：保存各unit的当前状态信息于持久存储设备中<br>向后兼容sysv init脚本<br>不兼容：<br>systemctl命令固定不变，不可扩展<br>非由systemd启动的服务，systemctl无法与之通信和控制<br>centos7 上的服务用systemctl管理 </li></ul><p>管理服务<br>管理系统服务：<br>CentOS 7: service unit<br>注意：能兼容早期的服务脚本<br>命令：systemctl COMMAND name.service<br>启动：service name start ==&gt; systemctl start   name.service<br>停止：service name stop ==&gt; systemctl stop   name.service<br>重启：service name restart ==&gt; systemctl restart name.service<br>状态：service name status ==&gt; systemctl status name.service   </p><ul><li>管理服务<br>条件式重启：已启动才重启，否则不做操作<br>service name condrestart ==&gt; systemctl try-restart name.service<br>重载或重启服务：先加载，再启动<br>systemctl reload-or-restart name.service<br>重载或条件式重启服务：<br>systemctl reload-or-try-restart name.service<br>禁止自动和手动启动：<br>systemctl mask name.service    通过软连接转移指向实现禁止和启用<br>取消禁止：<br>systemctl unmask name.service    </li></ul><ul><li><p>服务查看<br>查看某服务当前激活与否的状态：<br>systemctl is-active name.service<br>查看所有已经激活的服务：<br>systemctl list-units –type|-t service<br>查看所有服务：<br>systemctl list-units –type service –all|-a<br>chkconfig命令的对应关系：<br>设定某服务开机自启：<br>chkconfig name on ==&gt; systemctl enable name.service<br>设定某服务开机禁止启动：<br>chkconfig name off ==&gt; systemctl disable name.service<br>总结：<br>通过软件接实现服务的enable， disable  等</p></li><li><p>服务查看<br>查看所有服务的开机自启状态：<br>chkconfig –list ==&gt; systemctl list-unit-files –type service<br>用来列出该服务在哪些运行级别下启用和禁用<br>chkconfig sshd –list ==&gt;<br>ls /etc/systemd/system/*.wants/sshd.service<br>查看服务是否开机自启：<br>systemctl is-enabled name.service<br>其它命令：<br>查看服务的依赖关系：<br>systemctl list-dependencies name.service<br>杀掉进程：<br>systemctl kill unitname   </p></li></ul><ul><li>服务状态<br>systemctl list-unit-files –type service –all显示状态<br>loaded Unit配置文件已处理  （已加载）<br>active(running) 一次或多次持续处理的运行  （活动状态）<br>active(exited) 成功完成一次性的配置   （执行一次退出）<br>active(waiting) 运行中，等待一个事件<br>inactive 不运行<br>enabled 开机启动<br>disabled 开机不启动<br>static 开机不启动，但可被另一个启用的服务激活    </li></ul><ul><li>systemctl 命令示例<br>显示所有单元状态<br>systemctl 或 systemctl list-units<br>只显示服务单元的状态<br>systemctl –type=service<br>显示sshd服务单元<br>systemctl –l status sshd.service<br>验证sshd服务当前是否活动<br>systemctl is-active sshd<br>启动，停止和重启sshd服务<br>systemctl start sshd.service<br>systemctl stop sshd.service<br>systemctl restart sshd.service<br>重新加载配置<br>systemctl reload sshd.service<br>列出活动状态的所有服务单元<br>systemctl list-units –type=service<br>列出所有服务单元<br>systemctl list-units –type=service –all<br>查看服务单元的启用和禁用状态<br>systemctl list-unit-files –type=service<br>列出失败的服务<br>systemctl –failed –type=service<br>列出依赖的单元<br>systemctl list-dependencies sshd<br>验证sshd服务是否开机启动<br>systemctl is-enabled sshd<br>禁用network，使之不能自动启动,但手动可以<br>systemctl disable network<br>启用network<br>systemctl enable network<br>禁用network，使之不能手动或自动启动<br>systemctl mask network<br>启用network<br>systemctl unmask network    </li></ul><ul><li><p>service unit文件格式<br>/etc/systemd/system：系统管理员和用户使用  /usr/lib/systemd/system：发行版打包者使用<br>以 “#” 开头的行后面的内容会被认为是注释<br>相关布尔值，1、yes、on、true 都是开启，0、no、off、false 都是关闭<br>时间单位默认是秒，所以要用毫秒（ms）分钟（m）等须显式说明<br>service unit file文件通常由三部分组成：<br>[Unit]：定义与Unit类型无关的通用选项；用于提供unit的描述信息、unit行为及依赖关系等<br>[Service]：与特定类型相关的专用选项；此处为Service类型<br>[Install]：定义由“systemctl enable”以及”systemctl   disable“命令在实现服务启用或禁用时用到的一些选项    </p></li><li><p>service unit文件格式<br>Unit段的常用选项：<br>Description：描述信息<br>After：定义unit的启动次序，表示当前unit应该晚于哪些unit启  动，其功能与Before相反<br>Requires：依赖到的其它units，强依赖，被依赖的units无法激活时，当前unit也无法激活<br>Wants：依赖到的其它units，弱依赖<br>Conflicts：定义units间的冲突关系     </p></li></ul><ul><li><p>service unit文件格式<br>Service段的常用选项：<br>Type：定义影响ExecStart及相关参数的功能的unit进程启动类型<br>•simple：默认值，这个daemon主要由ExecStart接的指令串来启动，启动后常驻于内存中<br>•forking：由ExecStart启动的程序透过spawns延伸出其他子程序来作为此daemon的主要服务。原生父程序在启动结束后就会终止<br>•oneshot：与simple类似，不过这个程序在工作完毕后就结束了，不会常驻在内存中<br>•dbus：与simple类似，但这个daemon必须要在取得一个D-Bus的名称后，才会继续运作.因此通常也要同时设定BusNname= 才行<br>•notify：在启动完成后会发送一个通知消息。还需要配合 NotifyAccess 来让 Systemd 接收消息<br>•idle：与simple类似，要执行这个daemon必须要所有的工作都顺利执行完毕后才会执行。这类的daemon通常是开机到最后才执行即可的服务  </p></li><li><p>service unit文件格式<br>Install段的常用选项：<br>•Alias：别名，可使用systemctl command Alias.service<br>•RequiredBy：被哪些units所依赖，强依赖<br>•WantedBy：被哪些units所依赖，弱依赖<br>•Also：安装本服务的时候还要安装别的相关服务<br>注意：对于新创建的unit文件，或者修改了的unit文件，要通知systemd重载此配置文件,而后可以选择重启<br>systemctl daemon-reload    </p></li></ul><p>总结：<br>写成service unit 文件格式是为了用systemctl 管理</p><ul><li>服务Unit文件示例：<br>vim /etc/systemd/system/bak.service<br>[Unit]<br>Description=backup /etc<br>Requires=atd.service<br>[Service]<br>Type=simple<br>ExecStart=/bin/bash -c “echo /testdir/bak.sh|at now”<br>[Install]<br>WantedBy=multi-user.target<br>systemctl daemon-reload   加载到内存<br>systemctl start bak  </li></ul><pre><code>[root@Centos7 system]#vim httpd.service [Unit]Description=The Apache HTTP ServerAfter=network.target remote-fs.target nss-lookup.targetDocumentation=man:httpd(8)Documentation=man:apachectl(8)[Service]Type=notify  EnvironmentFile=/etc/sysconfig/httpd  ExecStart=/usr/sbin/httpd $OPTIONS -DFOREGROUND  ExecReload=/usr/sbin/httpd $OPTIONS -k graceful  ExecStop=/bin/kill -WINCH ${MAINPID}  # We want systemd to give httpd some time to finish  gracefully, but still want  # it to kill httpd after TimeoutStopSec if something went wrong during the  # graceful stop. Normally, Systemd sends SIGTERM signal right after the  # ExecStop, which would kill httpd. We are sending useless SIGCONT here to give  # httpd time to finish.  KillSignal=SIGCONT  PrivateTmp=true  [Install]  WantedBy=multi-user.target     </code></pre><ul><li>运行级别<br>target units：  （服务状态集|相当与运行级别）<br>unit配置文件：.target<br>ls /usr/lib/systemd/system/*.target<br>systemctl list-unit-files –type target –all<br>运行级别：<br>0 ==&gt; runlevel0.target, poweroff.target<br>1 ==&gt; runlevel1.target, rescue.target<br>2 ==&gt; runlevel2.target, multi-user.target<br>3 ==&gt; runlevel3.target, multi-user.target<br>4 ==&gt; runlevel4.target, multi-user.target<br>5 ==&gt; runlevel5.target, graphical.target<br>6 ==&gt; runlevel6.target, reboot.target<br>查看依赖性：<br>systemctl list-dependencies graphical.target   </li></ul><ul><li>运行级别<br>级别切换：init N ==&gt; systemctl isolate name.target<br>systemctl isolate multi-user.target<br>注：只有/lib/systemd/system/*.target文件中AllowIsolate=yes 才能切换(修改文件需执行systemctl daemon-reload才能生效)<br>查看target：<br>runlevel ;who -r<br>systemctl list-units –type target<br>获取默认运行级别：<br>/etc/inittab ==&gt; systemctl get-default<br>修改默认级别：<br>/etc/inittab ==&gt; systemctl set-default   name.target<br>systemctl set-default multi-user.target<br>ls –l /etc/systemd/system/default.target   </li></ul><ul><li>其它命令<br>切换至紧急救援模式：<br>systemctl rescue<br>切换至emergency模式：<br>systemctl emergency<br>其它常用命令：<br>传统命令init，poweroff，halt，reboot都成为<br>systemctl的软链接<br>关机：systemctl halt、systemctl poweroff<br>重启：systemctl reboot<br>挂起：systemctl suspend<br>休眠：systemctl hibernate<br>休眠并挂起：systemctl hybrid-sleep  </li></ul><h3 id="Centos7-引导顺序"><a href="#Centos7-引导顺序" class="headerlink" title="Centos7 引导顺序"></a>Centos7 引导顺序</h3><p>UEFi或BIOS初始化，运行POST开机自检<br>选择启动设备<br>引导装载程序, centos7是grub2<br>加载装载程序的配置文件：<br>/etc/grub.d/<br>/etc/default/grub<br>/boot/grub2/grub.cfg<br>加载initramfs驱动模块<br>加载内核选项<br>内核初始化，centos7使用systemd代替init<br>执行initrd.target所有单元，包括挂载  /etc/fstab<br>从initramfs根文件系统切换到磁盘根目录<br>systemd执行默认target配置，配置文件  /etc/systemd/system/default.target   </p><ul><li><p>CentOS7引导顺序<br>systemd执行sysinit.target初始化系统及   basic.target准备操作系统<br>systemd启动multi-user.target下的本机与服务器服务<br>systemd执行multi-user.target下 /etc/rc.d/rc.local<br>Systemd执行multi-user.target下的    getty.target及登录服务<br>systemd执行graphical需要的服务</p></li><li><p>设置内核参数<br>设置内核参数，只影响当次启动<br>启动时，在linux16行后添加<br>systemd.unit=desired.target<br>systemd.unit=emergency.target<br>systemd.unit=rescue.target<br>rescue.target 比emergency 支持更多的功能，例如日志等<br>systemctl default 进入默认target<br>分析各阶段启动花费的时间<br>[root@Centos7 grub.d]#systemd-analyze<br>Startup finished in 2.366s (kernel) + 4.155s (initrd) + 34.117s (userspace) = 40.639s</p></li></ul><ul><li><p>启动排错<br>文件系统损坏<br>先尝试自动修复，失败则进入emergency shell，<br>提示用户修复<br>在/etc/fstab不存在对应的设备和UUID<br>等一段时间，如不可用，进入emergency shell<br>在/etc/fstab不存在对应挂载点<br>systemd 尝试创建挂载点，否则提示进入  emergency shell.<br>在/etc/fstab不正确的挂载选项<br>提示进入emergency shell</p></li><li><p>破解CentOS7的root口令方法一<br>启动时任意键暂停启动<br>按e键进入编辑模式<br>将光标移动linux16开始的行，添加内核参数  rd.break（打断正常启动）<br>按ctrl-x启动<br>mount –o remount,rw /sysroot<br>chroot /sysroot<br>passwd root<br>touch /.autorelabel<br>exit<br>reboot    </p></li></ul><ul><li>破解CentOS7的root口令方法二<br>启动时任意键暂停启动<br>按e键进入编辑模式<br>将光标移动linux16开始的行，改为rw  init=/sysroot/bin/sh<br>按ctrl-x启动<br>chroot /sysroot<br>passwd root<br>touch /.autorelabel<br>exit<br>reboot  </li></ul><p>增加编辑模式 下口令<br>cp /boot/grub2/grub.cfg /date/<br>grub2-setpassword  </p><ul><li>修复GRUB2<br>GRUB“the Grand Unified Bootloader”<br>引导提示时可以使用命令行界面<br>可从文件系统引导<br>主要配置文件 /boot/grub2/grub.cfg<br>修复配置文件<br>grub2-mkconfig &gt; /boot/grub2/grub.cfg<br>修复grub<br>grub2-install /dev/sda BIOS环境<br>grub2-install UEFI环境<br>调整默认启动内核<br>vim /etc/default/grub   打开/etc/default/grub 文档<br>GRUB_DEFAULT=0   修改GRUB_DEFAULT这个值<br>grub2-mkconfig &gt;/boot/grub2/grub.cfg</li></ul><p>默认以那个内核作为启动项<br>/etc/default/grub<br>GRUB_DEFAULT=saved</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;systemd&lt;br&gt;POST –&amp;gt; Boot Sequence –&amp;gt; Bootloader –&amp;gt; kernel + initramfs(initrd) –&amp;gt; rootfs –&amp;gt; /sbin/init&lt;br&gt;init: CentOS 5 Sys
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="http://yoursite.com/2018/11/09/%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91/"/>
    <id>http://yoursite.com/2018/11/09/内核编译/</id>
    <published>2018-11-09T11:33:01.576Z</published>
    <updated>2018-11-10T07:03:52.024Z</updated>
    
    <content type="html"><![CDATA[<h2 id="内核编译"><a href="#内核编译" class="headerlink" title="内核编译"></a>内核编译</h2><p>单内核体系设计、但充分借鉴了微内核设计体系的优点，为内核引入模块化机制<br>内核组成部分：<br>kernel：内核核心，一般为bzImage，通常在/boot目录下<br>名称为 vmlinuz-VERSION-RELEASE<br>kernel object：内核对象，一般放置于<br>/lib/modules/VERSION-RELEASE/<br>[ ]: N<br>[M]: M<br>[*]: Y<br>辅助文件：ramdisk<br>initrd<br>initramfs   </p><p>编译内核<br>前提：<br>(1) 准备好开发环境<br>(2) 获取目标主机上硬件设备的相关信息<br>(3) 获取目标主机系统功能的相关信息<br>例如:需要启用相应的文件系统<br>(4) 获取内核源代码包<br><a href="http://www.kernel.org" target="_blank" rel="noopener">www.kernel.org</a>   </p><p>开发环境准备<br>包组<br>Development Tools<br>目标主机硬件设备相关信息<br>CPU：<br>cat /proc/cpuinfo<br>x86info -a<br>lscpu    </p><p>硬件设备<br>PCI设备：<br>lspci<br>-v<br>-vv<br>lsusb<br>-v<br>-vv<br>lsblk 块设备<br>了解全部硬件设备信息<br>hal-device：CentOS 6    </p><p>内核编译安装系统<br>安装开发包组<br>下载源码文件<br>.config：准备文本配置文件<br>make menuconfig：配置内核选项<br>make [-j #]<br>make modules_install：安装模块<br>make install ：安装内核相关文件<br>安装bzImage为/boot/vmlinuz-VERSION-RELEASE<br>生成initramfs文件<br>编辑grub的配置文件  </p><p>编译安装内核示例<br>tar xf linux-3.10.67.tar.xz -C /usr/src<br>cd /usr/src<br>ln -sv linux-3.10.67 linux<br>cd /usr/src/linux<br>cp /boot/config-$(uname -r) ./.config<br>make help<br>make menuconfig<br>make -j 2<br>make modules_install<br>make install<br>reboot  </p><p>编译内核<br>(1) 配置内核选项<br>支持“更新”模式进行配置：make help<br>(a) make config：基于命令行以遍历的方式配置内核中可配的每个选项<br>(b) make menuconfig：基于curses的文本窗口界面<br>(c) make gconfig：基于GTK (GNOME）环境窗口界面<br>(d) make xconfig：基于QT(KDE)环境的窗口界面<br>支持“全新配置”模式进行配置<br>(a) make defconfig：基于内核为目标平台提供的“默认”配置进行配置<br>(b) make allyesconfig: 所有选项均回答为“yes“<br>(c) make allnoconfig: 所有选项均回答为“no“   </p><p>编译内核<br>(2) 编译<br>全编译:make [-j #]<br>编译内核的一部分功能：<br>(a) 只编译某子目录中的相关代码<br>cd /usr/src/linux<br>make dir/<br>(b) 只编译一个特定的模块<br>cd /usr/src/linux<br>make dir/file.ko<br>示例：只为e1000编译驱动：<br>make drivers/net/ethernet/intel/e1000/e1000.ko    </p><p>编译内核<br>如何交叉编译内核：<br>编译的目标平台与当前平台不相同<br>make ARCH=arch_name<br>要获取特定目标平台的使用帮助<br>make ARCH=arch_name help<br>示例：<br>make ARCH=arm help   </p><p>内核编译<br>在已经执行过编译操作的内核源码树做重新编译<br>需要事先清理操作：<br>make clean：清理大多数编译生成的文件，但会保留config文件等<br>make mrproper: 清理所有编译生成的文件、config及某些备份文件<br>make distclean：mrproper、清理patches以及编辑器备份文件    </p><p>卸载内核<br>删除/lib/modules/目录下不需要的内核库文件<br>删除/usr/src/linux/目录下不需要的内核源码<br>删除/boot目录下启动的内核和内核映像文件<br>更改grub的配置文件，删除不需要的内核启动列表   </p><p>实验：编译内核 启用NTFS 文件系统<br>下载 linux-4.18.13<br>解压源码包<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 mkconfig]<span class="comment">#tar -xvf linux-4.18.13   </span></span><br><span class="line">``` </span><br><span class="line">拷贝.config文件</span><br><span class="line">```bash</span><br><span class="line">[root@Centos7 mkconfig]<span class="comment">#cp /boot/config-3.10.0-862.el7.x86_64 /date/mkconfig/linux-4.18.13/.config </span></span><br><span class="line">```  </span><br><span class="line">安装开发包组及其他安装包 搭建编译环境</span><br><span class="line">```bash   </span><br><span class="line">[root@Centos7 linux-4.18.13]<span class="comment">#yum groupinstall  Development Tools   </span></span><br><span class="line">```    </span><br><span class="line">```bash </span><br><span class="line">[root@Centos7 linux-4.18.13]<span class="comment">#yum install ncurses-devel</span></span><br></pre></td></tr></table></figure></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 linux-4.18.13]<span class="comment">#yum install elfutils-libelf-devel   </span></span><br><span class="line">```  </span><br><span class="line">```bash  </span><br><span class="line">[root@Centos7 linux-4.18.13]<span class="comment">#yum search openssl-devel  `</span></span><br><span class="line">```  </span><br><span class="line">配置内核选项 选择NTFX选项并设为[M]</span><br><span class="line">```bash     </span><br><span class="line">[root@Centos7 linux-4.18.13]<span class="comment">#make menuconfig   </span></span><br><span class="line">```   </span><br><span class="line">开始编译 </span><br><span class="line">```bash   </span><br><span class="line">[root@Centos7 linux-4.18.13]<span class="comment">#make -j 4 &amp;&amp; &#123; echo -e '\a';sleep 1;echo -e '\a'; &#125;  </span></span><br><span class="line">```   </span><br><span class="line">安装模块</span><br><span class="line">```bash  </span><br><span class="line">[root@Centos7 linux-4.18.13]<span class="comment">#make modules_install  </span></span><br><span class="line">```  </span><br><span class="line">查看模块安装情况   </span><br><span class="line"> ```bash  </span><br><span class="line">[root@Centos7 linux-4.18.13]<span class="comment">#ll /lib/modules/*</span></span><br><span class="line">```  </span><br><span class="line">安装内核相关文件  </span><br><span class="line">```bash  </span><br><span class="line">[root@Centos7 linux-4.18.13]<span class="comment">#make install</span></span><br></pre></td></tr></table></figure><p>查看/boot/* 下相关文件</p><pre><code class="bash">[root@Centos7 linux-4.18.13]<span class="comment">#ll /boot/*  </span></code></pre><p>reboot 重启<br>进入开始菜单界面 选择linux-4.18.13启动    </p><pre><code class="bash">[root@Centos7 ~]<span class="comment">#mount /dev/sdb3 /mnt  </span></code></pre><p>更新locate数据库 </p><pre><code class="bash">[root@Centos7 ~]<span class="comment">#updatedb   </span></code></pre><p>查询locate数据库</p><pre><code class="bash">[root@Centos7 ~]<span class="comment">#locate ntfs.ko   </span>[root@Centos7 ~]<span class="comment">#locate ntfs.ko</span>/date/mkconfig/linux-4.18.13/fs/ntfs/.ntfs.ko.cmd/date/mkconfig/linux-4.18.13/fs/ntfs/ntfs.ko/usr/lib/modules/4.18.13/kernel/fs/ntfs/ntfs.ko   </code></pre><p>再/mnt/创建文件 失败<br>安装ntfx-g3包</p><pre><code class="bash">[root@Centos7 ~]<span class="comment">#yum install ntfs-g3</span></code></pre><p>reboot重启  进入开始菜单界面 选择linux3.10.0-862启动<br>继续挂载/dev/sdb  /mnt/<br>在/mnt创建文件成功<br>删除编译安装  </p><pre><code class="bash">[root@Centos7 linux-4.18.13]<span class="comment">#make clean</span>[root@Centos7 linux-4.18.13]<span class="comment">#make mrproper</span>[root@Centos7 linux-4.18.13]<span class="comment">#rm -rf  /lib/modules/4.18.13/</span>[root@Centos7 boot]<span class="comment">#rm -fr *4.18*</span>[root@Centos7 date]<span class="comment">#rm -rf mkconfig/</span></code></pre><p>生成/boot/grub2/grub.cfg 文件  </p><pre><code class="bash">[root@Centos7 boot]<span class="comment">#grub2-mkconfig &gt; /boot/grub2/grub.cfg </span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;内核编译&quot;&gt;&lt;a href=&quot;#内核编译&quot; class=&quot;headerlink&quot; title=&quot;内核编译&quot;&gt;&lt;/a&gt;内核编译&lt;/h2&gt;&lt;p&gt;单内核体系设计、但充分借鉴了微内核设计体系的优点，为内核引入模块化机制&lt;br&gt;内核组成部分：&lt;br&gt;kernel：内核核心，
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="http://yoursite.com/2018/11/04/%E6%96%87%E4%BB%B6%E5%8E%8B%E7%BC%A9/"/>
    <id>http://yoursite.com/2018/11/04/文件压缩/</id>
    <published>2018-11-04T10:42:31.038Z</published>
    <updated>2018-11-05T13:39:48.075Z</updated>
    
    <content type="html"><![CDATA[<h2 id="压缩、解压缩及归档工具"><a href="#压缩、解压缩及归档工具" class="headerlink" title="压缩、解压缩及归档工具"></a>压缩、解压缩及归档工具</h2><ol><li>compress/uncompress  </li><li>gzip/gunzip</li><li>bzip2/bunzip2  </li><li>xz/unxz  </li><li>zip/unzip</li><li>tar</li><li>cpio</li><li>file-roller</li></ol><hr><h3 id="compress-uncompress"><a href="#compress-uncompress" class="headerlink" title="compress/uncompress"></a>compress/uncompress</h3><ul><li>compress [-dfvcVr] [-b maxbits] [file … ]<br>compress 可以压缩多个文件，把每个文件独立压缩<br>压缩为 *.Z 为后缀的文件<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 http]<span class="comment">#compress test</span></span><br></pre></td></tr></table></figure></li></ul><p>-d: 解压缩，相当于uncompress<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 http]<span class="comment">#compress -d test.Z</span></span><br></pre></td></tr></table></figure></p><p>-c: 结果输出至标准输出,不删除原文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">可以保留源文件 </span><br><span class="line"> [root@Centos7 http]<span class="comment">#compress -c test &gt; test1.Z </span></span><br><span class="line"><span class="built_in">test</span>  test1.Z</span><br></pre></td></tr></table></figure></p><p>-v: 显示详情  </p><ul><li>uncompress解压缩 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 http]<span class="comment">#uncompress test2.Z  </span></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">zcatfile.Z&gt;file  </span><br><span class="line">相当于变相的解压缩 ,同时可以看file文件的内容    </span><br><span class="line">```bash  </span><br><span class="line">[root@Centos7 http]<span class="comment">#zcat test.Z &gt;file </span></span><br><span class="line">-rw-r--r--. 1 root root 1048576000 Nov  4 19:44 file  </span><br><span class="line">-rw-r--r--. 1 root root 1048576000 Nov  4 19:23 test1  </span><br><span class="line">```    </span><br><span class="line">总结： compress 不支持更改后缀的解压缩 </span><br><span class="line">```bash  </span><br><span class="line">[root@Centos7 http]<span class="comment">#compress -cd test.z &gt;m  </span></span><br><span class="line">而对于重定向的方式，能完成解压缩</span><br><span class="line"></span><br><span class="line"><span class="comment">### gzip/gunzip  </span></span><br><span class="line">* gzip[OPTION]... FILE ...   </span><br><span class="line">```bash  </span><br><span class="line">[root@Centos7 http]<span class="comment">#gzip test1  </span></span><br><span class="line">-rw-r--r--. 1 root root    1017653 Nov  4 19:23 test1.gz  </span><br><span class="line">```  </span><br><span class="line">-d：解压缩，相当于gunzip   </span><br><span class="line">``` bash</span><br><span class="line">[root@Centos7 http]<span class="comment">#gzip -d test1.gz</span></span><br></pre></td></tr></table></figure></li></ul><p>-c：结果输出至标准输出，保留原文件不改变<br>-#：1-9，指定压缩比，值越大压缩比越大<br>gzip 默认压缩为6<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 http]<span class="comment">#gzip -5 -c  test2&gt; file1.gz  </span></span><br><span class="line">-rw-r--r--. 1 root root    1017653 Nov  4 19:54 file1.gz</span><br><span class="line">-rw-r--r--. 1 root root    1017653 Nov  4 19:23 test1.gz</span><br><span class="line">```  </span><br><span class="line">zcat：不显式解压缩的前提下查看文本文件内容  </span><br><span class="line"></span><br><span class="line">zcat 既能对Z 后缀查看和重定向又能对gz 后缀的文件 查看和重定向</span><br><span class="line">* 示例：  </span><br><span class="line">gzip-c messages &gt;messages.gz  </span><br><span class="line">gzip-c -d messages.gz &gt; messages  </span><br><span class="line">zcat messages.gz &gt; messages  </span><br><span class="line">cat messages | gzip&gt; m.gz   gzip 支持标准输入   </span><br><span class="line">```bash  </span><br><span class="line"> [root@Centos7 http]<span class="comment">#cat file4 |gzip &gt;file4.gz  </span></span><br><span class="line"> ```    </span><br><span class="line"></span><br><span class="line">补充：</span><br><span class="line">```bash  </span><br><span class="line">[root@Centos7 http]<span class="comment">#gzip -- -file -file1 -file2</span></span><br></pre></td></tr></table></figure></p><p>压缩<code>-file -file2</code>  这种文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 http]<span class="comment">#cp /etc/passwd  -- -file  </span></span><br><span class="line">``` </span><br><span class="line">```bash  </span><br><span class="line">[root@Centos7 http]<span class="comment">#cp /etc/passwd /date/-file</span></span><br></pre></td></tr></table></figure></p><p>通过这种方式可以生成<code>-file</code> 这种文件或者路径生成<code>-file</code></p><p> 总结：</p><ol><li>对于gzip压缩对后缀有要求，不能随便更改后缀</li><li>对于压缩过的文件，再对该文件压缩意义不大  </li><li>打包或压缩可能会丢失属性</li></ol><h3 id="bzip2-bunzip2-bzcat"><a href="#bzip2-bunzip2-bzcat" class="headerlink" title="bzip2/bunzip2/bzcat"></a>bzip2/bunzip2/bzcat</h3><ul><li>bzip2 [OPTION]… FILE …<br>-k：keep, 保留原文件  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 http]<span class="comment">#bzip2 -k file  </span></span><br><span class="line">-rw-r--r--. 1 root root        753 Nov  4 19:44 file.bz2</span><br></pre></td></tr></table></figure></li></ul><p>-d：解压缩<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 http]<span class="comment">#bzip2 -dc file.bz2&gt; file2  </span></span><br><span class="line">``` </span><br><span class="line">-<span class="comment">#：1-9，压缩比，默认为9  </span></span><br><span class="line">bzcat：不显式解压缩的前提下查看文本文件内容  </span><br><span class="line">* bunzip   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* 示例   </span><br><span class="line">```bash  </span><br><span class="line">[root@Centos7 http]<span class="comment">#cat file4 |bzip2 &gt; file4.bz2  </span></span><br><span class="line">```  </span><br><span class="line">```bash  </span><br><span class="line">[root@Centos7 http]<span class="comment">#bzcat file4.bz2 &gt;file5.bz2  </span></span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"><span class="comment">### xz/unxz/xzcat</span></span><br><span class="line">* xz[OPTION]... FILE ...  </span><br><span class="line">-k: keep, 保留原文件  </span><br><span class="line">```bash      </span><br><span class="line">[root@Centos7 http]<span class="comment">#xz -k test2</span></span><br></pre></td></tr></table></figure></p><p>-d：解压缩<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 http]<span class="comment">#xz -d test2.xz</span></span><br></pre></td></tr></table></figure></p><p>-#：1-9，压缩比，默认为6<br>unxz file.xz 解压缩<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 http]<span class="comment">#unxz -c test2.xz &gt;test5</span></span><br></pre></td></tr></table></figure></p><p>xzcat: 不显式解压缩的前提下查看文本文件内容<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 http]<span class="comment">#xzcat file.xz &gt; file6</span></span><br><span class="line">```   </span><br><span class="line">总结：compress, gzip, bzip2, xz 等压缩工具只能压缩文件</span><br><span class="line"><span class="comment">### zip/unzip  </span></span><br><span class="line">* 打包压缩  </span><br><span class="line">zip –r /backup/sysconfig /etc/sysconfig/  </span><br><span class="line">```bash  </span><br><span class="line">[root@Centos7 http]<span class="comment">#zip -r /date/sysconfig /etc/sysconfig/</span></span><br></pre></td></tr></table></figure></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 http]<span class="comment">#zip file6 file6 </span></span><br><span class="line">-rw-r--r--. 1 root root 1048576000 Nov  5 19:14 file6</span><br><span class="line">-rw-r--r--. 1 root root    1017789 Nov  5 19:27 file6.zip</span><br></pre></td></tr></table></figure><p>zip 可以压缩文件及文件夹     </p><ul><li>解包解压缩<br>unzip sysconfig.zip   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> [root@Centos7 http]<span class="comment">#unzip file6.zip   </span></span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">cat /var/<span class="built_in">log</span>/messages | zip messages -   </span><br><span class="line"></span><br><span class="line"><span class="string">"-"</span>表示标准输入</span><br><span class="line">unzip -p message &gt; message   </span><br><span class="line">```bash  </span><br><span class="line">[root@Centos7 http]<span class="comment">#unzip -p messages.zip  messagesm  </span></span><br><span class="line"> ```  </span><br><span class="line"> <span class="string">"-p"</span> 表示解压缩保留属性  </span><br><span class="line"></span><br><span class="line"><span class="comment">### tar工具  </span></span><br><span class="line"></span><br><span class="line">tar（Tape ARchive，磁带归档的缩写）    </span><br><span class="line">tar [OPTION]...    </span><br><span class="line">(1) 创建归档      </span><br><span class="line">* tar -cpvf/PATH/FILE.tar FILE...  </span><br><span class="line">-c 创建打包文件   </span><br><span class="line">-p  保留文件属性</span><br><span class="line">-v  显示打包过程</span><br><span class="line">-f  后面跟打包文件 </span><br><span class="line"></span><br><span class="line">```bash     </span><br><span class="line">[root@Centos7 http]<span class="comment">#tar -cvf sysconfig.tar  sysconfig</span></span><br></pre></td></tr></table></figure></li></ul><p>(2) 追加文件至归档：注：不支持对压缩文件追加<br>tar -r -f /PATH/FILE.tar FILE…<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 http]<span class="comment">#tar -rf sysconfig.tar  file7</span></span><br></pre></td></tr></table></figure></p><p>(3) 查看归档文件中的文件列表<br>tar -t -f /PATH/FILE.tar<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 http]<span class="comment">#tar -tf sysconfig</span></span><br></pre></td></tr></table></figure></p><p>(4) 展开归档<br>tar -x -f /PATH/FILE.tar<br>展开归档到当前路径<br>tar -x -f /PATH/FILE.tar -C /PATH/<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 http]<span class="comment">#tar -xf sysconfig.tar -C /date/linux-httpd/http/hot/</span></span><br></pre></td></tr></table></figure></p><p>-C 跟展开归档的路径<br>(5) 结合压缩工具实现：归档并压缩<br>-j: bzip2, -z: gzip, -J: xz<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 http]<span class="comment">#tar -cvpJf sysconfigg.tar.xz /etc/sysconfig/   </span></span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* exclude 排除文件</span><br><span class="line">tar zcvf/root/a3.tgz --exclude=/app/host1 --exclude=/app/host2 /app</span><br><span class="line">tgz 后缀等价于 tar.gz后缀  </span><br><span class="line">```bash  </span><br><span class="line">[root@Centos7 http]<span class="comment">#tar zcvf /date/mage.tgz --exclude=/date/httpd.log /date</span></span><br></pre></td></tr></table></figure></p><ul><li>-T选项指定输入文件,-X选项指定包含要排除的文件列表<br>tar zcvfmybackup.tgz -T /root/includefilelist -X /root/excludefilelist</li></ul><p>T 表示要打包的文件 ；-X 表示不需要打包的文件  </p><ul><li>splist:：分割一个文件为多个文件<br>分割大的tar 文件为多份小文件<br>split–b Size –d tar-file-name prefix-name  </li></ul><p>-b 表示切割文件大小<br>-d 表示以数字的形式添加后缀<br>split-b 1M –d mybackup.tgz mybackup-parts<br>split-b 1M mybackup.tgz mybackup-parts<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> [root@Centos7 http]<span class="comment">#split -b 10k  sysconfigg.tar.xz sysconfig  </span></span><br><span class="line"> -rw-r--r--. 1 root root      10240 Nov  5 20:59 sysconfigaa</span><br><span class="line">-rw-r--r--. 1 root root      10240 Nov  5 20:59 sysconfigab</span><br><span class="line">-rw-r--r--. 1 root root      10240 Nov  5 20:59 sysconfigac</span><br><span class="line">-rw-r--r--. 1 root root      10240 Nov  5 20:59 sysconfigad</span><br><span class="line">-rw-r--r--. 1 root root       4464 Nov  5 20:59 sysconfigae</span><br></pre></td></tr></table></figure></p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> [root@Centos7 http]<span class="comment">#split -b 10k -d  sysconfigg.tar.xz sysconfig    </span></span><br><span class="line">-rw-r--r--. 1 root root      10240 Nov  5 21:00 sysconfig00</span><br><span class="line">-rw-r--r--. 1 root root      10240 Nov  5 21:00 sysconfig01</span><br><span class="line">-rw-r--r--. 1 root root      10240 Nov  5 21:00 sysconfig02</span><br><span class="line">-rw-r--r--. 1 root root      10240 Nov  5 21:00 sysconfig03</span><br><span class="line">-rw-r--r--. 1 root root       4464 Nov  5 21:00 sysconfig04</span><br></pre></td></tr></table></figure><p>合并：<br>cat mybackup-parts* &gt; mybackup.tar.gz<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 http]<span class="comment">#cat sysconfiga* &gt; sysconfig1.tar.xz</span></span><br></pre></td></tr></table></figure></p><h3 id="cpio"><a href="#cpio" class="headerlink" title="cpio"></a>cpio</h3><ul><li>功能：复制文件从或到归档  </li><li>cpio命令是通过重定向的方式将文件进行打包备份，还原恢复的工具，它可以解压以“.cpio”或者“.tar”结尾的文件  </li><li>cpio[选项] &gt; 文件名或者设备名   </li><li>cpio[选项] &lt; 文件名或者设备名<br>选项<br>-o 将文件拷贝打包成文件或者将文件输出到设备上<br>-O filename输出到指定的归档文件名<br>-A向已存在的归档文件中追加文件<br>-i解包，将打包文件解压或将设备上的备份还原到系统<br>-I filename对指定的归档文件名解压<br>-t预览，查看文件内容或者输出到设备上的文件内容<br>-F filename使用指定的文件名替代标准输入或输出<br>-d 解包生成目录，在cpio还原时，自动的建立目录<br>-v 显示打包过程中的文件名称  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos6 date]<span class="comment">#cat hello | cpio -o  &gt; file2.cpio</span></span><br></pre></td></tr></table></figure></li></ul><pre><code class="bash">[root@Centos6 date]<span class="comment">#cpio -vtdi &lt; initramfs-2.6.32-754.el6.x86_64   </span></code></pre><ul><li>示例<br>将etc目录备份：<br>find ./etc-print |cpio-ov &gt; bak.cpio<br>将/data内容追加bak.cpio<br>find /data | cpio -oA-F bak.cpio<br>内容预览<br>cpio –tv &lt; etc.cpio<br>解包文件<br>cpio –idv &lt; etc.cpio  </li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;压缩、解压缩及归档工具&quot;&gt;&lt;a href=&quot;#压缩、解压缩及归档工具&quot; class=&quot;headerlink&quot; title=&quot;压缩、解压缩及归档工具&quot;&gt;&lt;/a&gt;压缩、解压缩及归档工具&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;compress/uncompress  &lt;/li&gt;
&lt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="http://yoursite.com/2018/10/14/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/"/>
    <id>http://yoursite.com/2018/10/14/权限管理/</id>
    <published>2018-10-14T01:41:08.085Z</published>
    <updated>2018-10-14T08:11:56.719Z</updated>
    
    <content type="html"><![CDATA[<h1 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h1><h2 id="文件属性"><a href="#文件属性" class="headerlink" title="文件属性"></a>文件属性</h2><ul><li>文件属性操作<br><img src="https://github.com/SugarSir/linux-/blob/master/pictrue/%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90.png?raw=true" alt="fileattr"><br>chown设置文件的所有者<br>chgrp设置文件的属组信息  <h2 id="修改文件的属主和属组"><a href="#修改文件的属主和属组" class="headerlink" title="修改文件的属主和属组"></a>修改文件的属主和属组</h2></li><li><p>修改文件的属主：chown<br>chown[OPTION]… [OWNER][:[GROUP]] FILE…<br>用法：<br>OWNER<br>OWNER:GROUP<br>:GROUP<br>命令中的冒号可用.替换<br>-R: 递归<br>chown[OPTION]… –reference=RFILE FILE…    </p></li><li><p>修改文件的属组：chgrp<br>chgrp[OPTION]… GROUP FILE…<br>chgrp[OPTION]… –reference=RFILE FILE…<br>-R 递归   </p></li></ul><h2 id="文件权限"><a href="#文件权限" class="headerlink" title="文件权限"></a>文件权限</h2><ul><li><p>文件的权限主要针对三类对象进行定义<br>owner: 属主, u<br>group: 属组, g<br>other: 其他, o  </p></li><li><p>每个文件针对每类访问者都定义了三种权限<br>r: Readable<br>w: Writable<br>x: eXcutable  </p></li><li><p>文件：<br>r: 可使用文件查看类工具获取其内容<br>w: 可修改其内容<br>x: 可以把此文件提请内核启动为一个进程  </p></li><li><p>目录：<br>r: 可以使用ls查看此目录中文件列表<br>w: 可在此目录中创建文件，也可删除此目录中的文件<br>x: 可以使用ls -l查看此目录中文件元数据（须配合r），可以cd进入此目录<br>X:只给目录x权限，不给文件x权限  </p></li></ul><h2 id="权限表示方法"><a href="#权限表示方法" class="headerlink" title="权限表示方法"></a>权限表示方法</h2><p>二进制、八进制表示的方法如下：<br>—000  &ensp; 0<br>–x 001 &ensp; 1<br>-w-010  &ensp;2<br>-wx 011  &ensp;3<br>r–100  &ensp;4<br>r-x 101  &ensp;5<br>rw-110  &ensp;6<br>rwx 111  &ensp;7<br>例如：<br>640: rw-r—–<br>755: rwxr-xr-x   </p><h2 id="文件权限操作"><a href="#文件权限操作" class="headerlink" title="文件权限操作"></a>文件权限操作</h2><h2 id="修改文件权限"><a href="#修改文件权限" class="headerlink" title="修改文件权限"></a>修改文件权限</h2><ul><li>chmod [OPTION]… OCTAL-MODE FILE…<br>-R: 递归修改权限  </li><li>chmod [OPTION]… MODE[,MODE]… FILE…<br>MODE：<br>修改一类用户的所有权限：<br>u= g= o= ug= a= u=,g=<br>修改一类用户某位或某些位权限<br>u+ u- g+ g- o+ o- a+ a- + -</li><li>chmod [OPTION]…   –reference=RFILE FILE…<br>参考RFILE文件的权限，将FILE的修改为同RFILE  </li></ul><h2 id="新建文件和目录的默认权限"><a href="#新建文件和目录的默认权限" class="headerlink" title="新建文件和目录的默认权限"></a>新建文件和目录的默认权限</h2><ul><li>umask值可以用来保留在创建文件权限    </li><li>新建FILE权限: 666-umask  </li><li>如果所得结果某位存在执行（奇数）权限，则将其权限+1  </li><li>新建DIR权限: 777-umask  </li><li>非特权用户umask是002  </li><li>root的umask 是022  </li><li>umask: 查看  </li><li>umask #: 设定  </li><li>umask 002  </li><li>umask –S 模式方式显示  </li><li>umask –p 输出可被调用  </li><li>全局设置： /etc/bashrc 用户设置:~/.bashrc    </li></ul><p>FILE: 666-umask</p><blockquote><p>注意：如果文件中某类用户的权限减得的结果中存在x权限，则将其权限-1<br>DIR:777-umask </p></blockquote><h2 id="Linux文件上的特殊权限"><a href="#Linux文件上的特殊权限" class="headerlink" title="Linux文件上的特殊权限"></a>Linux文件上的特殊权限</h2><ul><li>SUID, SGID, Sticky</li><li>三种常用权限：r, w, x user, group, other</li><li>安全上下文</li><li>前提：进程有属主和属组；文件有属主和属组<br>(1) 任何一个可执行程序文件能不能启动为进程,取决发起者对程序文件是否拥有执行权限<br>(2) 启动为进程之后，其进程的属主为发起者,进程的属组为发起者所属的组<br>(3) 进程访问文件时的权限，取决于进程的发起者<br>(a) 进程的发起者，同文件的属主：则应用文件属主权限<br>(b) 进程的发起者，属于文件属组；则应用文件属组权限<br>(c) 应用文件“其它”权限  </li></ul><h2 id="可执行文件上SUID权限"><a href="#可执行文件上SUID权限" class="headerlink" title="可执行文件上SUID权限"></a>可执行文件上SUID权限</h2><ul><li>任何一个可执行程序文件能不能启动为进程：取决发起者对程序文件是否拥有执行权限  </li><li>启动为进程之后，其进程的属主为原程序文件的属主  </li><li>SUID只对二进制可执行程序有效  </li><li>SUID设置在目录上无意义  </li><li>权限设定<br>chmodu+sFILE…<br>chmodu-s FILE…</li></ul><h2 id="目录上的SGID权限"><a href="#目录上的SGID权限" class="headerlink" title="目录上的SGID权限"></a>目录上的SGID权限</h2><ul><li>默认情况下，用户创建文件时，其属组为此用户所属的主组  </li><li>一旦某目录被设定了SGID，则对此目录有写权限的用户在此目录中创建的文件所属的组为此目录的属组  </li><li>通常用于创建一个协作目录  </li><li>权限设定：<br>chmodg+sDIR…<br>chmodg-s DIR…   </li></ul><h2 id="Sticky-位"><a href="#Sticky-位" class="headerlink" title="Sticky 位"></a>Sticky 位</h2><ul><li>具有写权限的目录通常用户可以删除该目录中的任何文件，无论该文件的权限或拥有权  </li><li>在目录设置Sticky 位，只有文件的所有者或root可以删除该文件  </li><li>sticky 设置在文件上无意义  </li><li>权限设定：<br>chmodo+tDIR…<br>chmodo-t DIR… </li></ul><h2 id="特殊权限数字法"><a href="#特殊权限数字法" class="headerlink" title="特殊权限数字法"></a>特殊权限数字法</h2><p>三个特殊位组成一组权限：suidsgidsticky</p><ul><li>SUID SGID STICKY<br>000 0<br>001 1<br>010 2<br>011 3<br>100 4<br>101 5<br>110 6<br>111 7  </li><li>chmod4777 /tmp/a.txt  </li></ul><h2 id="权限位映射"><a href="#权限位映射" class="headerlink" title="权限位映射"></a>权限位映射</h2><ul><li>SUID: user,占据属主的执行权限位<br>s：属主拥有x权限<br>S：属主没有x权限  </li><li>SGID: group,占据属组的执行权限位<br>s：group拥有x权限<br>S：group没有x权限  </li><li>Sticky: other,占据other的执行权限位<br>t：other拥有x权限<br>T：other没有x权限  </li></ul><h2 id="设定文件特定属性"><a href="#设定文件特定属性" class="headerlink" title="设定文件特定属性"></a>设定文件特定属性</h2><ul><li>chattr+i不能删除，改名，更改</li><li>chattr+a 只能追加内容</li><li>lsattr显示特定属性  </li></ul><h2 id="访问控制列表"><a href="#访问控制列表" class="headerlink" title="访问控制列表"></a>访问控制列表</h2><ul><li>ACL：Access Control List，实现灵活的权限管理  </li><li>除了文件的所有者，所属组和其它人，可以对更多的用户设置权限  </li><li>CentOS7默认创建的xfs和ext4文件系统具有ACL功能  </li><li>CentOS7之前版本，默认手工创建的ext4文件系统无ACL功能,需手动增加<br>tune2fs –o acl/dev/sdb1<br>mount –o acl/dev/sdb1 /mnt/test</li><li>ACL生效顺序：所有者，自定义用户，自定义组，其他人  </li></ul><h3 id="为多用户或者组的文件和目录赋予访问权限rwx"><a href="#为多用户或者组的文件和目录赋予访问权限rwx" class="headerlink" title="为多用户或者组的文件和目录赋予访问权限rwx"></a>为多用户或者组的文件和目录赋予访问权限rwx</h3><ul><li>mount -o acl/directory  </li><li>getfacl  file|directory  </li><li>setfacl -m u:wang:rwx file|directory  </li><li>setfacl -Rm g:sales:rwX directory  </li><li>setfacl -M file.aclfile|directory  </li><li>setfacl -m g:salesgroup:rw file| directory  </li><li>setfacl -m d:u:wang:rx directory  </li><li>setfacl -x u:wang file |directory  </li><li>setfacl -X file.acldirectory    </li></ul><h2 id="访问控制列表-1"><a href="#访问控制列表-1" class="headerlink" title="访问控制列表"></a>访问控制列表</h2><ul><li>ACL文件上的group权限是mask 值（自定义用户，自定义组，拥有组的最大权限）,而非传统的组权限</li><li>getfacl可看到特殊权限：flags</li><li>通过ACL赋予目录默认x权限，目录内文件也不会继承x权限</li><li>base ACL 不能删除</li><li>setfacl-k dir 删除默认ACL权限</li><li>setfacl–b file1清除所有ACL权限| </li><li>setfacl–set-file=-file2 复制file1的acl权限给file2  </li></ul><h3 id="mask只影响除所有者和other的之外的人和组的最大权限"><a href="#mask只影响除所有者和other的之外的人和组的最大权限" class="headerlink" title="mask只影响除所有者和other的之外的人和组的最大权限"></a>mask只影响除所有者和other的之外的人和组的最大权限</h3><ul><li>Mask需要与用户的权限进行逻辑与运算后，才能变成有限的权限(Effective Permission)<br>用户或组的设置必须存在于mask权限设定范围内才会生效setfacl-m mask::rxfile  </li><li>–set选项会把原有的ACL项都删除，用新的替代，需要注意的是一定要包含UGO的设置，不能象-m一样只是添加ACL就可以  </li><li>示例：<br>setfacl –set u::rw,u:wang:rw,g::r,o::-file1</li></ul><h3 id="备份和恢复ACL"><a href="#备份和恢复ACL" class="headerlink" title="备份和恢复ACL"></a>备份和恢复ACL</h3><p>主要的文件操作命令cp和mv都支持ACL，只是cp命令需要加上-p 参数。但是tar等常见的备份工具是不会保留目录和文件的ACL信息<br>getfacl-R /tmp/dir1 &gt; acl.txt<br>setfacl -R -b /tmp/dir1<br>setfacl-R –set-file=acl.txt/tmp/dir1<br>setfacl–restore acl.txt<br>getfacl -R /tmp/dir1  </p><p>练习<br>1、在/testdir/dir里创建的新文件自动属于webs组，组apps的成员如：tomcat能对这些新文件有读写权限，组dbs的成员如：mysql只能对新文件有读权限，其它用户（不属于webs,apps,dbs）不能访问这个文件夹  </p><pre><code class="bash">[root@Centos6 ~]<span class="comment">#mkdir -p /testdir/dir  </span>[root@Centos6 ~]<span class="comment">#chgrp webs /testdir/dir/  </span>[root@Centos6 testdir]<span class="comment">#chmod g+s dir  </span>[root@Centos6 testdir]<span class="comment">#setfacl -m g:apps:rw dir/  </span>[root@Centos6 testdir]<span class="comment">#setfacl -m g:dbs:r dir/  </span></code></pre><p>2、备份/testdir/dir里所有文件的ACL权限到/root/acl.txt中，清除/testdir/dir中所有ACL权限，最后还原ACL权限<br><code>`</code>bash<br>[root@Centos6 testdir]#getfacl -R dir/ &gt; dir/acl.txt  </p><p>[root@Centos6 testdir]#setfacl -R -b dir/  </p><p>[root@Centos6 testdir]#setfacl -R –set-file=dir/acl.txt dir/</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;权限管理&quot;&gt;&lt;a href=&quot;#权限管理&quot; class=&quot;headerlink&quot; title=&quot;权限管理&quot;&gt;&lt;/a&gt;权限管理&lt;/h1&gt;&lt;h2 id=&quot;文件属性&quot;&gt;&lt;a href=&quot;#文件属性&quot; class=&quot;headerlink&quot; title=&quot;文件属性&quot;&gt;&lt;/a
      
    
    </summary>
    
    
  </entry>
  
</feed>
